<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LibGuides Review</title>
    <%- include ('partials/header-includes') %>
    <script src="/js/filters.js"></script>
    <script>
        $(document).ready(function () {
            buildStatusFilter();
            let types = new URLSearchParams(window.location.search).get('types') || [];
            if (types.length > 0) {
                $('#selectType input[type="checkbox"]').prop('checked', false);
                types = types.split(',');
                types.forEach(function(type) {
                    $(`input[type="checkbox"][value="${type}"]`).prop('checked', true);
                });
            }
            $('#myTable').DataTable();

            $('#selectType input').on('change', function () {
                $('#myTable').DataTable().draw();
                let checkedTypes = [];
                    $('input[type="checkbox"]').each(function () {
                    if ($(this).is(':checked')) {
                        checkedTypes.push($(this).val());
                    }
                });
                $('.inspect-link').each(function () {              
                    let currentHref = $(this).attr('href');
                    const baseUrl = window.location.origin;
                    // console.log(checkedTypes)
                    // // Create a URL object
                    let url = new URL(currentHref, baseUrl);
                    if (checkedTypes.length > 0) {
                        // Add the 'types' parameter to the URL
                        url.searchParams.set('types', checkedTypes.join(','));
                        $(this).attr('href', url.toString());
                    } else {
                        // If no types are checked, remove the 'types' parameter
                        url.searchParams.delete('types');
                        $(this).attr('href', url.toString());
                    }
                });
     
                });
                    
            });
    </script>
</head>
<body class="container">
    <h1>LibGuides Review</h1>
    <div>
        <a href="/report" download><button class="btn btn-success mt-4 mb-2"><i class="bi bi-cloud-download"></i> Download Full Report CSV</button></a>
    </div>
    <div id="selectTypeBox" class="mb-3">
        <h2 class="h4">Filter by Type</h2>
        <form id="selectType"></form>
    </div>
    <table class="table table-striped" id="myTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Owner</th>
                <th>Type</th>
                <th>Status</th>
                <th>Keywords</th>
                <th># Pages</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <% summary.forEach(function(document) { %>
                <tr>
                    <td><a href="<%= document.url %>" target="_blank"><%= document.name %></a></td>
                    <td><%= document.owner_name %></td>
                    <td><%= document.type_label %></td>
                    <td><%= document.status_label %></td>
                    <td><%= JSON.stringify(document.terms).replaceAll('","', '", "') %></td>
                    <td><%= document.page_urls.length %></td>
                    <td><a href="/inspect/<%= document.id %>" class="inspect-link"><i class="bi bi-eye"></i></a></td>
                </tr>
            <% }); %>
        </tbody>
    </table>
</body>
</html>